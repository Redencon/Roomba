<!doctype html>
<html lang="en" data-bs-theme="auto">
  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.122.0">
    <title>Signin - Roomba</title>
    <link rel="icon" href="../assets/favicon.ico" type="image/x-icon">

    <link rel="canonical" href="https://getbootstrap.com/docs/5.3/examples/sign-in/">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

    <link href="../static/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../static/style.css" rel="stylesheet">
    <script src="https://yastatic.net/s3/passport-sdk/autofill/v1/sdk-suggest-token-with-polyfills-latest.js"></script>
    
    <!-- Custom styles for this template -->
    <link href="../static/sign-in.css" rel="stylesheet">
  </head>
  <body class="d-flex align-items-center py-4 bg-body-tertiary">
    <main class="form-signin w-100 m-auto">
      <form method="post" id="login-form">
        <img class="mb-4" src="../static/icon.png" alt="" width="80" height="80">
        <h1 class="h3 mb-3 fw-normal">Введите свой пароль</h1>
        {% if error %}
        <div id="error-message" class="alert alert-danger">{{ error }}</div>
        {% endif %}

        <div class="form-floating">
          <input type="password" class="form-control" id="password" placeholder="Password" name="password" required>
          <label for="password">Пароль</label>
        </div>

        <button class="button w-100 py-2 mb-4" type="submit">Войти</button>
      </form>
      <p>Не полуичли пароль?<br><a href="/request-password">Запросите новый</a></p>
    </main>
    <script src="../static/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Extract the token from the URL fragment
      const token = new URLSearchParams(window.location.hash.substring(1)).get('access_token');
      if (token) {
        // Send the token to the server for authentication
        fetch('/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ token: token })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Redirect to the main page or show a success message
            window.location.href = '/';
          } else {
            // Show an error message
            document.getElementById('error-message').innerText = data.error;
          }
        })
        .catch(error => console.error('Error:', error));
      }
    </script>
  </body>
</html>
